---
title: "The analysis of variables influencing movie ratings"
author: "Group 09"
number-sections: true
format: 
  html:
    embed-resources: true
    code-tools: true
  pdf:
    geometry: "left=2cm, right=2cm, top=2cm, bottom=2cm"
editor_options: 
  chunk_output_type: inline
execute:
  echo: false
  eval: true
  warning: false
  message: false
---

```{r}
library(ggplot2)
library(tidyverse)
library(skimr)
library(moderndive)
library(gapminder)
library(sjPlot)
library(stats)
library(jtools)
library(kableExtra)
library(GGally)
library(caret)
```

## Introduction

The following analysis aims to understand the relationship between a set of descriptive variables about a film and its success measured by its respective IMDB rating.

The central question around this analysis will be the following: **Which properties of films influence whether they are rated by IMDB as greater than 7 or not?**

From this question it is established that the target variable will be binary and hence a Logistic Regression model seems reasonable for this scenario. It is also established that missing variables ( in case they are found ) will be inputted with a summary statistic like mean or median if the distribution of this subset is similar to that of the complete data set, otherwise they will be deleted if they do not represent a large portion of the data set.

Throughout this analysis a full model will be fitted taking into account all numerical and categorical variables in the data set. Then the best performing model will be selected and it will only include those variables which are found to be significant.

Finally, a short summary of the model and answers to the analysis question will be found in the conclusion section.

## Data Cleaning

The film data set obtained from IMDB contains the following variables:

-   film.id - The unique identifier for the film

-   year - Year of release of the film in cinemas

-   length - Duration (in minutes)

-   budget - Budget for the films production (in \$1000000s)

-   votes - Number of positive votes received by viewers

-   genre - Genre of the film

-   rating - IMDB rating from 0-10

```{r}
#Read data set
film <- read.csv("dataset09.csv") %>% 
  mutate(target = ifelse(rating>7, 1, 0)) %>%  #Define target variable
  mutate(Rating = ifelse(rating>7, ">7", "<=7"))  #Define Rating variable help us get better data visualisation

#Create summary
film %>% 
  skim()
```

It is now established that film_id will not be used as an explanatory variable since it is only an identifier for the film, rather than an informative feature about it. Genre is the only categorical variable contained in the data set. Year, length, budget, and votes are the numerical explanatory variables to be tested in this analysis.

When it comes to the data set, there seems to be an issue with the length variable as there are 127 rows where this information is missing.


```{r}
#Group by genre and select the variables 'genre' and 'length'
film %>% 
  group_by(genre) %>%
  select(genre, length) %>%
  skim()
```

It is evident in from the summary table above that the length distribution is not equal among different film genres and therefore the missing film lengths will be handled by adding the median film length by genre to its corresponding missing columns (the mean is not used to avoid outlier influence). The different behaviour between genre and film length was expected, especially because one category is called "Short".

```{r}
#Median length of each genre
film.median <- film %>%
  group_by(genre) %>%
  select(genre, length) %>%
  summarise(median.length = median(length, na.rm=TRUE))
film.median
```

```{r}
#Input corresponding genre median for length missing values 
film <- film %>%
  inner_join(film.median,by=join_by(genre)) %>%
  mutate(had_NAS=ifelse(is.na(length),TRUE,FALSE),length=ifelse(is.na(length),median.length,length)) %>%
  select(-median.length) 
```

```{r}
set.seed(123)
train_index <- createDataPartition(film$target, p = 0.8, list = FALSE)

film_train <- film[train_index, ]
film_test <- film[-train_index, ]
```


## Exploratory Analysis

The last step before fitting the Logistic Regression model is analysing the data set to identify possible patterns.

```{r}
#| echo: true
#| label: fig_1
#| fig-cap: graphical and numberical summaries of the relationships between pairs of variables
#| fig-width: 8
#| fig-height: 5
#| fig-align: center
film$Rating <- as.factor(film$Rating) 
ggpairs(film[,c(2,3,4,5,7,9)], aes(colour = Rating, alpha = 0.4)) 
```

```{r}
#| echo: true
#| label: tbl_1
#| tbl-cap: Summary of counts by genre
#| tbl-width: 8
#| tbl-height: 5
#| tbl-align: center
# To show original counts
film %>% 
  tabyl(genre, Rating) %>% 
  adorn_percentages() %>% 
  adorn_pct_formatting() %>% 
  adorn_ns() 
```

```{r}
#| echo: true
#| label: fig_2
#| fig-cap: Proportion of Movie Ratings by Genre
#| fig-width: 8
#| fig-height: 5
#| fig-align: center

#Proportion of films with rating >7 by genre
ggplot(film, aes(x= Rating,  y = ..prop.., group=genre, fill=genre)) + 
    geom_bar(position="dodge", stat="count") +
    labs(y = "Proportion")
```

## Model Fitting

```{r}
#Fit a full model with all possible covariates
model1 <- glm(target ~ year + length + budget + votes + genre , data = film, 
             family = binomial(link = "logit"))
model1 %>%
  summary()
```

The year the film was released is not significant in the model above. This is expected as the year a certain movie was released might not say much about its success on IMDB.

```{r}
#Fit without year, change votes to thousands so the scale is easier to interpret
model2 <- glm(target ~ length + budget + votes + genre , data = film %>%
                mutate(votes=votes/1000), family = binomial(link = "logit"))
model2 %>%
  summary()
```

```{r}
summ(model2)
```

```{r}
mod2coefs <- round(coef(model2), 3)
mod2coefs
```

```{r}
confint(model2) %>%
  kable()
```

```{r}
plot_model(model2., type = "pred", title = "",
            axis.title = c("Ethnicity", "Prob. of instructor being male"))
```

```{r}
film <- film %>% 
  mutate(probs=fitted(model2))
```

```{r}
#obtain the model equation and display it using latek to be able to determine which variables influence a film's success the most 
```

## Conclusion

```{r}
#Write a conclusion about which variables were non-significant, which were significant and how much they influence the probability of having a score >7
```
